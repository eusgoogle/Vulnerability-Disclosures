# MNDT-2023-0005

## Description
An Elevation of Privilege Vulnerability exists in Microsoft's Windows Common Log File System Driver (clfs.sys) when a specially crafted Base Log File(blf) is parsed. 

## Impact
High - Exploiting the vulnerability will give a local unprivileged attacker SYSTEM level privileges. 

## Exploitability
High - Any authenticated local user can exploit the vulnerability and an exploit is trivial to produce.

## CVE Reference
CVE-2023-28252

## Common Vulnerability Scoring System
Base Score: 7.8 - Vector: AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H

## Technical Details
An Out of bound (OOB) read and write vulnerability exists in `CClfsBaseFilePersisted::ExtendMetadataBlock` and `CClfsBaseFilePersisted::WriteMetadataBlock` when parsing a malformed `BLF` file. The OOB read leads to one byte increment of the `rgContainers[0]` value, that results pointing to a fake `CONTAINER_CONTEXT` with a user space address `0x5000000` treated as an object's vftable pointer, detonating the placed gadgets and escalating privilege to `SYSTEM`.

## Resolution
The issue was fixed as part of April 2023 Microsoft security update.

## Discovery Credits
- Genwei Jiang, Google Cloud + Mandiant, FLARE OTF

## Disclosure Timeline
- 26-Mar-2022 - Issue reported to MSFT
- 11-Apr-2023 - Patched version released by MSFT
 
## References
- [Microsoft Advisory](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2023-28252)
- [Mitre CVE-2023-28252](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-28252)
